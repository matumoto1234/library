name: include guard check

on: 
  workflow_runs:
    workflows:
      - verify
    types:
      - 'completed'

jobs:
  checking-include-guard:

    runs-on: ubuntu-latest

    steps:
    - name: 'Checkout'
      uses: actions/checkout@v2
      with:
        fetch-depth: 0
    - name: checking
      run: |
        for file in $(git diff ${{ github.event.before }}..${{ github.event.after }} --name-only --diff-filter=d -- "*.hpp") ; do
          echo $file
          head -n 1 $file | xargs echo | sed "s/ //g" | xargs test \#pragmaonce =
          if [ $? != 0 ]; then
            echo 'Failed'
            exit 1
          fi
        done
        echo 'Succeed!'
        exit 0
